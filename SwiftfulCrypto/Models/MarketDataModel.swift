//
//  MarketDataModel.swift
//  SwiftfulCrypto
//
//  Created by Juan David Gutierrez Olarte on 27/08/25.
//

import Foundation
// JSONData:
/*
 URL
 /https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {"data":{"active_cryptocurrencies":18432,"upcoming_icos":0,"ongoing_icos":49,"ended_icos":3376,"markets":1353,"total_market_cap":{"btc":35449446.1008416,"eth":861734960.3603792,"ltc":34964358833.96789,"bch":7136737863.145112,"bnb":4594571616.870949,"eos":7889075673545.461,"xrp":1314452575382.6433,"xlm":10310797223717.416,"link":162469607799.01764,"dot":1019593671593.8983,"yfi":719419454.1064185,"sol":18901378977.106037,"usd":3975595654322.494,"aed":14601965278761.094,"ars":5.371007266874246e+15,"aud":6108220455575.058,"bdt":483753035525967.06,"bhd":1499069902184.0752,"bmd":3975595654322.494,"brl":21559655233390.9,"cad":5484063864633.389,"chf":3190622243567.828,"clp":3.850483659080965e+15,"cny":28441411311023.14,"czk":83846986075431.92,"dkk":25516919416151.316,"eur":3418054144164.656,"gbp":2945836867939.8833,"gel":10694352310127.516,"hkd":30955438856968.785,"huf":1356224130406731.5,"idr":6.505463094870495e+16,"ils":13235155492805.023,"inr":348498150798713.0,"jpy":585985270688092.5,"krw":5.539533541902129e+15,"kwd":1214938056365.3003,"lkr":1201197264739200.5,"mmk":8.34477527842292e+15,"mxn":74214571022913.11,"myr":16836647596055.771,"ngn":6.108462966909973e+15,"nok":40076429308919.875,"nzd":6784147253127.313,"php":227165527736796.12,"pkr":1120621025062153.5,"pln":14583347564311.904,"rub":319446044263633.7,"sar":14917130624257.514,"sek":37898196474320.95,"sgd":5112007745323.616,"thb":128749665265234.03,"try":163162802906232.4,"twd":121491364620798.31,"uah":164172294105969.28,"vef":398076392867.31134,"vnd":1.0486932025859982e+17,"zar":70330473702574.83,"xdr":2787099284654.0947,"xag":103063341742.6564,"xau":1170932188.0676045,"bits":35449446100841.59,"sats":3544944610084159.5},"total_volume":{"btc":1257267.0602470874,"eth":30562705.471968234,"ltc":1240062722.547404,"bch":253114968.4941767,"bnb":162953280.94564795,"eos":279797742168.6664,"xrp":46619005571.60792,"xlm":365687680348.8127,"link":5762225045.65787,"dot":36161398248.22147,"yfi":25515275.4594794,"sol":670365373.6524258,"usd":141000382539.75632,"aed":517880305030.2712,"ars":190490720159049.53,"aud":216637076745.17532,"bdt":17157017210683.531,"bhd":53166732243.50086,"bmd":141000382539.75632,"brl":764645074513.099,"cad":194500439687.5812,"chf":113160139008.04657,"clp":136563100501230.17,"cny":1008716736689.4174,"czk":2973757428924.511,"dkk":904995304288.9646,"eur":121226347891.99844,"gbp":104478463454.30869,"gel":379291029031.9447,"hkd":1097880443594.1704,"huf":48100495579595.32,"idr":2.307258747447557e+15,"ils":469404373513.103,"inr":12360002588188.307,"jpy":20782834702983.445,"krw":196467753869984.4,"kwd":43089575903.767006,"lkr":42602238396600.59,"mmk":295959802950948.7,"mxn":2632129576074.2915,"myr":597136620055.8683,"ngn":216645677768510.3,"nok":1421369866234.0928,"nzd":240609820784.20218,"php":8056761576320.915,"pkr":39744482828393.83,"pln":517220000238.8376,"rub":11329626641736.574,"sar":529058110356.1105,"sek":1344115615640.1787,"sgd":181304918887.59805,"thb":4566297388550.01,"try":5786810235850.867,"twd":4308871016141.8223,"uah":5822613334986.126,"vef":14118368303.705801,"vnd":3719345617321505.5,"zar":2494374317338.687,"xdr":98848600180.26129,"xag":3655293916.9606447,"xau":41528842.669434436,"bits":1257267060247.0874,"sats":125726706024708.73},"market_cap_percentage":{"btc":56.17121334803385,"eth":14.018460991749226,"xrp":4.527867194230704,"usdt":4.203693745715756,"bnb":3.0329281229982508,"sol":2.864646132528326,"usdc":1.7381334096757204,"steth":1.0144440170775764,"doge":0.841769973943787,"trx":0.8320050667017677},"market_cap_change_percentage_24h_usd":1.42919750015312,"updated_at":1756320948}}
 */

// MARK: - Swift
struct GlobalData: Codable {
    let data: MarketDataModel?
}

// MARK: - DataClass
struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String,CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}


